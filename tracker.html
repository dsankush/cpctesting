<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ¯ FitTrack â€” Your Weight Journey ğŸš€</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Fredoka:wght@400;500;600;700&family=Poppins:wght@600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    :root{
      --bg:#0d0221;
      --bg-secondary:#1a0b2e;
      --card:#2d1b4e;
      --text:#f4f1ff;
      --text-secondary:#b8a4d4;
      --pink:#ff006e;
      --yellow:#ffbe0b;
      --cyan:#00f5ff;
      --purple:#8338ec;
      --green:#06ffa5;
      --orange:#fb5607;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;overflow-x:hidden}
    body{
      font-family:'Fredoka',sans-serif;
      background:var(--bg);
      color:var(--text);
      background-image:
        radial-gradient(circle at 15% 20%, rgba(255,0,110,.15) 0%, transparent 40%),
        radial-gradient(circle at 85% 60%, rgba(131,56,236,.15) 0%, transparent 40%),
        radial-gradient(circle at 50% 90%, rgba(0,245,255,.12) 0%, transparent 50%);
      background-attachment:fixed;
      position:relative;
    }
    
    /* Quirky floating shapes */
    body::before,
    body::after{
      content:'';
      position:fixed;
      border-radius:50%;
      pointer-events:none;
      z-index:0;
    }
    body::before{
      width:300px;height:300px;
      background:radial-gradient(circle, rgba(255,190,11,.2), transparent 70%);
      top:-150px;right:-150px;
      animation:float1 20s ease-in-out infinite;
    }
    body::after{
      width:400px;height:400px;
      background:radial-gradient(circle, rgba(131,56,236,.15), transparent 70%);
      bottom:-200px;left:-200px;
      animation:float2 25s ease-in-out infinite;
    }
    @keyframes float1{
      0%,100%{transform:translate(0,0) rotate(0deg)}
      50%{transform:translate(-100px,100px) rotate(180deg)}
    }
    @keyframes float2{
      0%,100%{transform:translate(0,0) rotate(0deg)}
      50%{transform:translate(100px,-100px) rotate(-180deg)}
    }
    
    .app{display:grid;grid-template-rows:auto 1fr auto;min-height:100vh;position:relative;z-index:1}
    
    /* Header - Quirky Style */
    header{
      position:sticky;top:0;z-index:30;
      backdrop-filter:saturate(200%) blur(25px);
      background:rgba(13,2,33,.95);
      border-bottom:4px solid;
      border-image:linear-gradient(90deg,var(--pink),var(--yellow),var(--cyan),var(--purple)) 1;
      box-shadow:0 10px 40px rgba(255,0,110,.25);
    }
    .bar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding:16px 24px;
      flex-wrap:wrap;
    }
    .logo{
      display:flex;
      align-items:center;
      gap:12px;
      padding:12px 24px;
      border-radius:50px;
      background:linear-gradient(135deg, rgba(255,0,110,.25), rgba(131,56,236,.25));
      border:3px solid rgba(255,0,110,.5);
      box-shadow:0 0 30px rgba(255,0,110,.4), inset 0 0 20px rgba(255,255,255,.1);
      position:relative;
      overflow:hidden;
    }
    .logo::before{
      content:'';
      position:absolute;
      inset:0;
      background:linear-gradient(45deg, transparent, rgba(255,255,255,.2), transparent);
      transform:translateX(-100%);
      animation:shine 3s infinite;
    }
    @keyframes shine{
      0%{transform:translateX(-100%)}
      100%{transform:translateX(200%)}
    }
    .logo-icon{
      font-size:2rem;
      animation:wiggle 2s ease-in-out infinite;
    }
    @keyframes wiggle{
      0%,100%{transform:rotate(-15deg) scale(1)}
      25%{transform:rotate(15deg) scale(1.1)}
      50%{transform:rotate(-15deg) scale(1)}
      75%{transform:rotate(15deg) scale(1.1)}
    }
    .title{
      font-size:1.5rem;
      margin:0;
      font-weight:700;
      font-family:'Fredoka',sans-serif;
      background:linear-gradient(135deg,var(--pink),var(--yellow),var(--cyan));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      background-size:200% 200%;
      animation:gradientShift 4s ease infinite;
    }
    @keyframes gradientShift{
      0%,100%{background-position:0% 50%}
      50%{background-position:100% 50%}
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:12px 24px;
      border-radius:50px;
      border:3px solid;
      background:linear-gradient(135deg,var(--pink),var(--purple));
      border-color:rgba(255,255,255,.3);
      color:white;
      font-weight:700;
      cursor:pointer;
      font-size:14px;
      transition:all .3s cubic-bezier(0.68,-0.55,0.265,1.55);
      box-shadow:0 6px 25px rgba(255,0,110,.4);
      font-family:'Fredoka',sans-serif;
      position:relative;
      overflow:hidden;
    }
    .btn::before{
      content:'';
      position:absolute;
      inset:0;
      background:linear-gradient(135deg,transparent,rgba(255,255,255,.3),transparent);
      transform:translateX(-100%);
      transition:transform .5s;
    }
    .btn:hover::before{transform:translateX(100%)}
    .btn:hover{
      transform:translateY(-4px) scale(1.05);
      box-shadow:0 12px 40px rgba(255,0,110,.6);
    }
    .btn:active{
      transform:translateY(-1px) scale(0.98);
    }

    /* Main Layout */
    .main{
      display:flex;
      flex-direction:column;
      gap:24px;
      padding:24px 16px;
      max-width:1600px;
      margin:0 auto;
      width:100%;
    }

    /* Goal Setting Section */
    .goal-section{
      background:linear-gradient(135deg, rgba(45,27,78,.9) 0%, rgba(26,11,46,.9) 100%);
      border:3px solid;
      border-image:linear-gradient(135deg,var(--pink),var(--yellow),var(--cyan)) 1;
      border-radius:32px;
      padding:24px;
      box-shadow:0 15px 50px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.1);
      position:relative;
      overflow:hidden;
    }
    .goal-section::before{
      content:'ğŸ¯';
      position:absolute;
      font-size:15rem;
      opacity:.05;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%) rotate(-15deg);
      pointer-events:none;
    }
    .goal-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:24px;
      flex-wrap:wrap;
      gap:16px;
      position:relative;
      z-index:2;
    }
    .goal-title{
      font-size:1.8rem;
      font-weight:700;
      font-family:'Fredoka',sans-serif;
      background:linear-gradient(135deg,var(--yellow),var(--pink),var(--cyan));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      display:flex;
      align-items:center;
      gap:12px;
    }
    .goal-stats{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
      gap:16px;
      position:relative;
      z-index:2;
    }
    .goal-stat{
      background:rgba(255,255,255,.08);
      border:3px solid var(--stat-border);
      border-radius:24px;
      padding:20px 16px;
      text-align:center;
      transition:all .4s cubic-bezier(0.68,-0.55,0.265,1.55);
      position:relative;
      overflow:hidden;
    }
    .goal-stat::before{
      content:attr(data-emoji);
      position:absolute;
      font-size:4rem;
      opacity:.15;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%) rotate(-10deg);
      pointer-events:none;
    }
    .goal-stat:hover{
      transform:translateY(-8px) rotate(2deg);
      border-color:var(--stat-glow);
      box-shadow:0 15px 40px var(--stat-shadow);
    }
    .goal-stat-label{
      font-size:11px;
      color:var(--text-secondary);
      text-transform:uppercase;
      letter-spacing:1px;
      font-weight:700;
      margin-bottom:10px;
      position:relative;
      z-index:2;
    }
    .goal-stat-value{
      font-size:2rem;
      font-weight:700;
      font-family:'Fredoka',sans-serif;
      color:var(--stat-color);
      line-height:1.2;
      text-shadow:0 0 20px var(--stat-shadow);
      position:relative;
      z-index:2;
    }
    .goal-stat:nth-child(1){--stat-color:var(--pink);--stat-border:var(--pink);--stat-glow:var(--pink);--stat-shadow:rgba(255,0,110,.5)}
    .goal-stat:nth-child(2){--stat-color:var(--cyan);--stat-border:var(--cyan);--stat-glow:var(--cyan);--stat-shadow:rgba(0,245,255,.5)}
    .goal-stat:nth-child(3){--stat-color:var(--yellow);--stat-border:var(--yellow);--stat-glow:var(--yellow);--stat-shadow:rgba(255,190,11,.5)}
    .goal-stat:nth-child(4){--stat-color:var(--green);--stat-border:var(--green);--stat-glow:var(--green);--stat-shadow:rgba(6,255,165,.5)}

    /* Quick Stats Hero */
    .hero-stats{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
      gap:16px;
    }
    .stat-card{
      background:linear-gradient(135deg, rgba(45,27,78,.9) 0%, rgba(26,11,46,.9) 100%);
      border:3px solid var(--stat-color);
      border-radius:28px;
      padding:24px 16px;
      position:relative;
      overflow:hidden;
      transition:all .4s cubic-bezier(0.68,-0.55,0.265,1.55);
      box-shadow:0 10px 35px rgba(0,0,0,.4);
      text-align:center;
    }
    .stat-card::before{
      content:'';
      position:absolute;
      top:-50%;
      right:-50%;
      width:200%;
      height:200%;
      background:radial-gradient(circle, var(--stat-glow) 0%, transparent 70%);
      animation:rotate 10s linear infinite;
    }
    @keyframes rotate{
      0%{transform:rotate(0deg)}
      100%{transform:rotate(360deg)}
    }
    .stat-card:hover{
      transform:translateY(-12px) rotate(-2deg) scale(1.05);
      box-shadow:0 20px 60px var(--stat-shadow);
    }
    .stat-icon{
      font-size:3rem;
      margin-bottom:12px;
      filter:drop-shadow(0 6px 20px var(--stat-shadow));
      animation:bounce 2s ease-in-out infinite;
      position:relative;
      z-index:2;
    }
    @keyframes bounce{
      0%,100%{transform:translateY(0) rotate(0deg)}
      25%{transform:translateY(-15px) rotate(-10deg)}
      50%{transform:translateY(0) rotate(0deg)}
      75%{transform:translateY(-8px) rotate(10deg)}
    }
    .stat-label{
      font-size:11px;
      color:var(--text-secondary);
      text-transform:uppercase;
      letter-spacing:1.2px;
      font-weight:700;
      margin-bottom:10px;
      position:relative;
      z-index:2;
    }
    .stat-value{
      font-size:2.5rem;
      font-weight:700;
      font-family:'Fredoka',sans-serif;
      color:var(--stat-color);
      line-height:1;
      margin-bottom:10px;
      text-shadow:0 0 25px var(--stat-shadow);
      position:relative;
      z-index:2;
    }
    .stat-change{
      font-size:13px;
      font-weight:600;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      position:relative;
      z-index:2;
    }

    .stat-card:nth-child(1){--stat-color:var(--pink);--stat-glow:rgba(255,0,110,.3);--stat-shadow:rgba(255,0,110,.6)}
    .stat-card:nth-child(2){--stat-color:var(--cyan);--stat-glow:rgba(0,245,255,.3);--stat-shadow:rgba(0,245,255,.6)}
    .stat-card:nth-child(3){--stat-color:var(--yellow);--stat-glow:rgba(255,190,11,.3);--stat-shadow:rgba(255,190,11,.6)}
    .stat-card:nth-child(4){--stat-color:var(--green);--stat-glow:rgba(6,255,165,.3);--stat-shadow:rgba(6,255,165,.6)}

    /* Content Grid */
    .content{
      display:grid;
      grid-template-columns:repeat(12,1fr);
      gap:16px;
    }
    .card{
      background:linear-gradient(135deg, rgba(45,27,78,.95) 0%, rgba(26,11,46,.95) 100%);
      border:3px solid rgba(255,0,110,.4);
      border-radius:28px;
      padding:24px;
      box-shadow:0 12px 40px rgba(0,0,0,.5);
      transition:all .3s ease;
      position:relative;
      overflow:hidden;
    }
    .card::after{
      content:'';
      position:absolute;
      top:50%;
      left:50%;
      width:500px;
      height:500px;
      background:radial-gradient(circle, rgba(255,0,110,.08) 0%, transparent 70%);
      transform:translate(-50%,-50%);
      pointer-events:none;
    }
    .card:hover{
      border-color:var(--pink);
      transform:translateY(-6px);
      box-shadow:0 20px 60px rgba(255,0,110,.4);
    }
    .card h3{
      margin:0 0 20px;
      font-size:1.3rem;
      color:var(--text);
      font-weight:700;
      font-family:'Fredoka',sans-serif;
      display:flex;
      align-items:center;
      gap:10px;
      position:relative;
      z-index:2;
    }

    /* Weight Entry Table */
    .table-container{
      overflow-x:auto;
      position:relative;
      z-index:2;
      margin:0 -12px;
      padding:0 12px;
    }
    .weight-table{
      width:100%;
      border-collapse:separate;
      border-spacing:0 10px;
      min-width:600px;
    }
    .weight-table thead th{
      text-align:left;
      padding:12px 16px;
      font-size:11px;
      color:var(--text-secondary);
      text-transform:uppercase;
      letter-spacing:1px;
      font-weight:700;
      border-bottom:3px solid rgba(255,0,110,.3);
    }
    .weight-table tbody tr{
      background:rgba(255,255,255,.05);
      transition:all .3s cubic-bezier(0.68,-0.55,0.265,1.55);
      cursor:pointer;
    }
    .weight-table tbody tr:hover{
      background:rgba(255,0,110,.15);
      transform:translateX(8px) scale(1.02);
    }
    .weight-table tbody td{
      padding:16px;
      border-top:2px solid rgba(255,0,110,.2);
      border-bottom:2px solid rgba(255,0,110,.2);
      font-size:14px;
      font-weight:600;
    }
    .weight-table tbody td:first-child{
      border-left:2px solid rgba(255,0,110,.2);
      border-radius:16px 0 0 16px;
      color:var(--cyan);
      font-weight:700;
    }
    .weight-table tbody td:last-child{
      border-right:2px solid rgba(255,0,110,.2);
      border-radius:0 16px 16px 0;
    }
    .weight-value{
      font-size:1.5rem;
      font-weight:700;
      font-family:'Fredoka',sans-serif;
      background:linear-gradient(135deg,var(--pink),var(--cyan));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }

    /* Input Groups */
    .input-group{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-bottom:20px;
    }
    .input-group label{
      font-size:12px;
      color:var(--text-secondary);
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:1px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .input-group input,
    .input-group select,
    .input-group textarea{
      padding:14px 18px;
      border-radius:16px;
      border:3px solid rgba(255,0,110,.3);
      background:rgba(255,255,255,.08);
      color:var(--text);
      font-size:15px;
      font-family:'Fredoka',sans-serif;
      font-weight:600;
      transition:all .3s ease;
    }
    .input-group input:focus,
    .input-group select:focus,
    .input-group textarea:focus{
      outline:none;
      border-color:var(--pink);
      background:rgba(255,0,110,.15);
      box-shadow:0 0 0 4px rgba(255,0,110,.2);
    }

    /* Footer */
    .footer{
      padding:24px;
      color:var(--text-secondary);
      border-top:3px solid;
      border-image:linear-gradient(90deg,var(--pink),var(--purple),var(--cyan)) 1;
      text-align:center;
      font-size:14px;
      background:rgba(13,2,33,.95);
      font-weight:600;
    }

    /* Modal */
    .modal-overlay{
      position:fixed;
      inset:0;
      background:rgba(13,2,33,.98);
      backdrop-filter:blur(20px);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:100;
      padding:16px;
    }
    .modal-overlay.active{display:flex}
    .modal{
      background:linear-gradient(135deg, rgba(45,27,78,.98) 0%, rgba(26,11,46,.98) 100%);
      border:4px solid var(--pink);
      border-radius:32px;
      padding:32px;
      max-width:500px;
      width:100%;
      max-height:90vh;
      overflow-y:auto;
      box-shadow:0 30px 90px rgba(0,0,0,.8), 0 0 0 1px rgba(255,0,110,.3);
      animation:popIn .4s cubic-bezier(0.68,-0.55,0.265,1.55);
      position:relative;
    }
    .modal::before{
      content:'';
      position:absolute;
      top:0;left:0;right:0;
      height:5px;
      background:linear-gradient(90deg,var(--pink),var(--yellow),var(--cyan),var(--purple));
      background-size:200% 100%;
      animation:gradientMove 3s linear infinite;
    }
    @keyframes popIn{
      0%{opacity:0;transform:scale(0.5) rotate(-10deg)}
      70%{transform:scale(1.05) rotate(2deg)}
      100%{opacity:1;transform:scale(1) rotate(0)}
    }
    @keyframes gradientMove{
      0%{background-position:0% 0%}
      100%{background-position:200% 0%}
    }
    .modal h2{
      margin:0 0 24px;
      font-size:2rem;
      font-weight:700;
      font-family:'Fredoka',sans-serif;
      background:linear-gradient(135deg,var(--pink),var(--yellow),var(--cyan));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      display:flex;
      align-items:center;
      gap:12px;
    }

    /* Responsive */
    @media (max-width: 768px){
      .main{padding:16px 12px}
      .bar{padding:12px 16px}
      .logo{padding:10px 16px;gap:8px}
      .logo-icon{font-size:1.5rem}
      .title{font-size:1.1rem}
      .btn{padding:10px 20px;font-size:13px}
      .goal-section{padding:20px 16px;border-radius:24px}
      .goal-title{font-size:1.4rem}
      .goal-stats{grid-template-columns:repeat(2,1fr)}
      .goal-stat{padding:16px 12px}
      .goal-stat-value{font-size:1.6rem}
      .hero-stats{grid-template-columns:repeat(2,1fr)}
      .stat-card{padding:20px 12px}
      .stat-icon{font-size:2.5rem}
      .stat-value{font-size:2rem}
      .stat-label{font-size:10px}
      .stat-change{font-size:12px}
      .card{padding:20px 16px;border-radius:24px}
      .card h3{font-size:1.1rem}
      .modal{padding:24px 20px}
      .modal h2{font-size:1.5rem}
      .content > *{grid-column:span 12 !important}
      .weight-table{font-size:13px}
      .weight-table thead th{padding:10px 12px;font-size:10px}
      .weight-table tbody td{padding:12px}
      .weight-value{font-size:1.2rem}
    }
    
    @media (max-width: 480px){
      .bar{flex-direction:column;gap:12px}
      .logo{width:100%;justify-content:center}
      .header-actions{width:100%}
      .btn{width:100%;justify-content:center}
      .goal-header{flex-direction:column;align-items:stretch}
      .goal-stats{grid-template-columns:1fr}
      .hero-stats{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="bar">
      <div class="logo">
        <span class="logo-icon">ğŸ¯</span>
        <h1 class="title">FitTrack</h1>
      </div>
      <div class="header-actions">
        <button class="btn" id="addEntryBtn">â• Add Weight</button>
      </div>
    </div>
  </header>

  <main class="main">
    <!-- Goal Setting Section -->
    <section class="goal-section">
      <div class="goal-header">
        <h2 class="goal-title">ğŸ¯ Your Goal</h2>
        <button class="btn" id="setGoalBtn">âš™ï¸ Set Goal</button>
      </div>
      
      <div class="goal-stats">
        <div class="goal-stat" data-emoji="ğŸ">
          <div class="goal-stat-label">ğŸ Start</div>
          <div class="goal-stat-value" id="startWeight">145</div>
        </div>
        <div class="goal-stat" data-emoji="âš–ï¸">
          <div class="goal-stat-label">âš–ï¸ Current</div>
          <div class="goal-stat-value" id="currentWeight">133.4</div>
        </div>
        <div class="goal-stat" data-emoji="ğŸ¯">
          <div class="goal-stat-label">ğŸ¯ Target</div>
          <div class="goal-stat-value" id="targetWeight">125</div>
        </div>
        <div class="goal-stat" data-emoji="ğŸ“Š">
          <div class="goal-stat-label">ğŸ“Š Progress</div>
          <div class="goal-stat-value" id="progressPercent">58%</div>
        </div>
      </div>
    </section>

    <!-- Quick Stats Hero -->
    <section class="hero-stats">
      <div class="stat-card">
        <div class="stat-icon">ğŸ”¥</div>
        <div class="stat-label">Total Lost</div>
        <div class="stat-value" id="totalLost">11.6</div>
        <div class="stat-change">kg lost! ğŸ‰</div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">ğŸš€</div>
        <div class="stat-label">To Goal</div>
        <div class="stat-value" id="toGo">8.4</div>
        <div class="stat-change">kg to go!</div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">â°</div>
        <div class="stat-label">Journey</div>
        <div class="stat-value" id="journeyDays">74</div>
        <div class="stat-change">days ğŸ’ª</div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">ğŸ“ˆ</div>
        <div class="stat-label">Avg/Week</div>
        <div class="stat-value" id="avgLoss">1.1</div>
        <div class="stat-change">kg/week</div>
      </div>
    </section>

    <!-- Content Grid -->
    <section class="content">
      <!-- Weight Progress Chart -->
      <div class="card" style="grid-column: span 8">
        <h3>ğŸ“Š Weight Journey</h3>
        <canvas id="weightChart" height="280"></canvas>
      </div>

      <!-- Weight Change Chart -->
      <div class="card" style="grid-column: span 4">
        <h3>ğŸ“‰ Changes</h3>
        <canvas id="changeChart" height="280"></canvas>
      </div>

      <!-- Weight Data Table -->
      <div class="card" style="grid-column: span 12">
        <h3>ğŸ“‹ Weight History</h3>
        <div class="table-container">
          <table class="weight-table" id="weightTable">
            <thead>
              <tr>
                <th>ğŸ“… Date</th>
                <th>âš–ï¸ Weight</th>
                <th>ğŸ“‰ Change</th>
                <th>ğŸ“Š From Start</th>
                <th>ğŸ¯ To Goal</th>
              </tr>
            </thead>
            <tbody id="weightTableBody">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <div class="footer">
    ğŸ¯ FitTrack Â© 2025 â€” Keep Going! You Got This! ğŸ’ªğŸ”¥
  </div>
</div>

<!-- Add Entry Modal -->
<div class="modal-overlay" id="entryModal">
  <div class="modal">
    <h2>â• Add Weight</h2>
    
    <div class="input-group">
      <label>ğŸ“… Date</label>
      <input type="date" id="entryDate" value="">
    </div>

    <div class="input-group">
      <label>âš–ï¸ Weight (kg)</label>
      <input type="number" step="0.1" id="entryWeight" placeholder="75.5">
    </div>

    <div class="input-group">
      <label>ğŸ“ Notes (Optional)</label>
      <textarea id="entryNotes" rows="3" placeholder="How are you feeling?"></textarea>
    </div>

    <div style="display:flex;gap:12px;margin-top:24px;flex-wrap:wrap">
      <button class="btn" id="saveEntryBtn" style="flex:1;min-width:120px">ğŸ’¾ Save</button>
      <button class="btn" id="closeEntryModalBtn" style="flex:1;min-width:120px;background:linear-gradient(135deg,#666,#444)">âœ–ï¸ Cancel</button>
    </div>
  </div>
</div>

<!-- Set Goal Modal -->
<div class="modal-overlay" id="goalModal">
  <div class="modal">
    <h2>ğŸ¯ Set Goal</h2>
    
    <div class="input-group">
      <label>ğŸ Start Weight (kg)</label>
      <input type="number" step="0.1" id="goalStartWeight" placeholder="145">
    </div>

    <div class="input-group">
      <label>ğŸ¯ Target Weight (kg)</label>
      <input type="number" step="0.1" id="goalTargetWeight" placeholder="125">
    </div>

    <div class="input-group">
      <label>ğŸ“… Target Date (Optional)</label>
      <input type="date" id="goalTargetDate">
    </div>

    <div style="display:flex;gap:12px;margin-top:24px;flex-wrap:wrap">
      <button class="btn" id="saveGoalBtn" style="flex:1;min-width:120px">ğŸ’¾ Save</button>
      <button class="btn" id="closeGoalModalBtn" style="flex:1;min-width:120px;background:linear-gradient(135deg,#666,#444)">âœ–ï¸ Cancel</button>
    </div>
  </div>
</div>

<script>
  const CSV_URL = './weight.csv';
  
  // State
  let WEIGHT_DATA = [];
  let GOAL = {
    startWeight: 145,
    targetWeight: 125,
    targetDate: null
  };

  // Load goal from localStorage
  const savedGoal = localStorage.getItem('fittrack_goal');
  if(savedGoal){
    GOAL = JSON.parse(savedGoal);
  }

  // Date utilities
  const trim = (s) => (s == null ? '' : String(s).trim());
  
  const parseWeightDate = (dateStr) => {
    if(!dateStr) return '';
    const s = trim(dateStr);
    if(!s) return '';
    
    const months = {
      'jan': '01', 'feb': '02', 'mar': '03', 'apr': '04',
      'may': '05', 'jun': '06', 'jul': '07', 'aug': '08',
      'sep': '09', 'oct': '10', 'nov': '11', 'dec': '12'
    };
    
    const parts = s.split('-');
    if(parts.length === 3){
      const day = parts[0].trim().padStart(2, '0');
      const monthStr = parts[1].trim().toLowerCase();
      let year = parts[2].trim();
      
      if(year.length === 2){
        const yearNum = parseInt(year);
        year = yearNum < 50 ? '20' + year : '19' + year;
      }
      
      const month = months[monthStr];
      if(month){
        return year + '-' + month + '-' + day;
      }
    }
    
    return s;
  };

  const formatDisplayDate = (dateKey) => {
    if(!dateKey) return '';
    const d = new Date(dateKey);
    if(isNaN(d)) return dateKey;
    
    const options = { month: 'short', day: 'numeric', year: 'numeric' };
    return d.toLocaleDateString('en-US', options);
  };

  // Modal handlers
  const entryModal = document.getElementById('entryModal');
  const goalModal = document.getElementById('goalModal');
  
  document.getElementById('addEntryBtn').onclick = () => {
    document.getElementById('entryDate').value = new Date().toISOString().slice(0,10);
    entryModal.classList.add('active');
  };
  
  document.getElementById('closeEntryModalBtn').onclick = () => entryModal.classList.remove('active');
  document.getElementById('closeGoalModalBtn').onclick = () => goalModal.classList.remove('active');
  
  entryModal.onclick = (e) => { if(e.target === entryModal) entryModal.classList.remove('active'); };
  goalModal.onclick = (e) => { if(e.target === goalModal) goalModal.classList.remove('active'); };

  document.getElementById('setGoalBtn').onclick = () => {
    document.getElementById('goalStartWeight').value = GOAL.startWeight;
    document.getElementById('goalTargetWeight').value = GOAL.targetWeight;
    goalModal.classList.add('active');
  };

  // Save Entry
  document.getElementById('saveEntryBtn').onclick = () => {
    const date = document.getElementById('entryDate').value;
    const weight = parseFloat(document.getElementById('entryWeight').value);
    const notes = document.getElementById('entryNotes').value;
    
    if(!date || !weight){
      alert('âš ï¸ Please enter both date and weight!');
      return;
    }

    // Add to data
    const newEntry = {
      Date: date,
      'Weight in Kg': weight,
      Notes: notes || ''
    };
    
    WEIGHT_DATA.push(newEntry);
    
    // Sort by date
    WEIGHT_DATA.sort((a,b) => {
      const dateA = parseWeightDate(a.Date);
      const dateB = parseWeightDate(b.Date);
      return dateA.localeCompare(dateB);
    });
    
    // Save to localStorage
    localStorage.setItem('fittrack_entries', JSON.stringify(WEIGHT_DATA));
    
    // Clear form
    document.getElementById('entryWeight').value = '';
    document.getElementById('entryNotes').value = '';
    
    entryModal.classList.remove('active');
    
    // Re-render
    render();
    
    alert('âœ… Weight entry added successfully!');
  };

  // Save Goal
  document.getElementById('saveGoalBtn').onclick = () => {
    const startWeight = parseFloat(document.getElementById('goalStartWeight').value);
    const targetWeight = parseFloat(document.getElementById('goalTargetWeight').value);
    const targetDate = document.getElementById('goalTargetDate').value;
    
    if(!startWeight || !targetWeight){
      alert('âš ï¸ Please enter both starting and target weight!');
      return;
    }

    GOAL = {
      startWeight: startWeight,
      targetWeight: targetWeight,
      targetDate: targetDate || null
    };
    
    localStorage.setItem('fittrack_goal', JSON.stringify(GOAL));
    
    goalModal.classList.remove('active');
    render();
    
    alert('ğŸ¯ Goal updated successfully!');
  };

  // Charts
  let weightChart = null;
  let changeChart = null;

  function updateStats(){
    if(WEIGHT_DATA.length === 0) return;
    
    const weights = WEIGHT_DATA.map(d => parseFloat(d['Weight in Kg']));
    const currentWeight = weights[weights.length - 1];
    const startWeight = GOAL.startWeight;
    const targetWeight = GOAL.targetWeight;
    
    const totalLost = startWeight - currentWeight;
    const toGo = currentWeight - targetWeight;
    const progress = ((startWeight - currentWeight) / (startWeight - targetWeight) * 100).toFixed(0);
    
    // Calculate journey days
    const firstDate = new Date(parseWeightDate(WEIGHT_DATA[0].Date));
    const lastDate = new Date(parseWeightDate(WEIGHT_DATA[WEIGHT_DATA.length - 1].Date));
    const journeyDays = Math.ceil((lastDate - firstDate) / (1000 * 60 * 60 * 24));
    
    // Average loss per week
    const weeks = journeyDays / 7;
    const avgLoss = weeks > 0 ? (totalLost / weeks).toFixed(1) : 0;
    
    // Update goal stats
    document.getElementById('startWeight').textContent = startWeight.toFixed(1);
    document.getElementById('currentWeight').textContent = currentWeight.toFixed(1);
    document.getElementById('targetWeight').textContent = targetWeight.toFixed(1);
    document.getElementById('progressPercent').textContent = progress + '%';
    
    // Update hero stats
    document.getElementById('totalLost').textContent = totalLost.toFixed(1);
    document.getElementById('toGo').textContent = toGo.toFixed(1);
    document.getElementById('journeyDays').textContent = journeyDays;
    document.getElementById('avgLoss').textContent = avgLoss;
  }

  function renderTable(){
    const tbody = document.getElementById('weightTableBody');
    tbody.innerHTML = '';
    
    if(WEIGHT_DATA.length === 0){
      tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:40px;color:var(--text-secondary)">ğŸ“Š No entries yet! Click "Add Weight" to start! ğŸš€</td></tr>';
      return;
    }
    
    const startWeight = GOAL.startWeight;
    const targetWeight = GOAL.targetWeight;
    
    WEIGHT_DATA.forEach((entry, i) => {
      const weight = parseFloat(entry['Weight in Kg']);
      const prevWeight = i > 0 ? parseFloat(WEIGHT_DATA[i-1]['Weight in Kg']) : startWeight;
      const change = weight - prevWeight;
      const fromStart = weight - startWeight;
      const toGoal = weight - targetWeight;
      
      const changeColor = change < 0 ? 'var(--cyan)' : change > 0 ? 'var(--pink)' : 'var(--text-secondary)';
      const changeArrow = change < 0 ? 'â†“' : change > 0 ? 'â†‘' : 'â†’';
      
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${formatDisplayDate(parseWeightDate(entry.Date))}</td>
        <td><span class="weight-value">${weight.toFixed(1)}</span> kg</td>
        <td style="color:${changeColor};font-weight:700">
          ${change !== 0 ? changeArrow + ' ' + Math.abs(change).toFixed(1) + ' kg' : 'â€”'}
        </td>
        <td style="color:var(--cyan);font-weight:700">
          ${fromStart < 0 ? 'â†“ ' + Math.abs(fromStart).toFixed(1) : fromStart > 0 ? 'â†‘ ' + fromStart.toFixed(1) : '0'} kg
        </td>
        <td style="color:var(--yellow);font-weight:700">
          ${toGoal.toFixed(1)} kg
        </td>
      `;
      tbody.appendChild(row);
    });
  }

  function renderCharts(){
    if(WEIGHT_DATA.length === 0) return;
    
    const dates = WEIGHT_DATA.map(d => formatDisplayDate(parseWeightDate(d.Date)));
    const weights = WEIGHT_DATA.map(d => parseFloat(d['Weight in Kg']));
    
    // Weight Chart
    const weightCtx = document.getElementById('weightChart').getContext('2d');
    const weightGradient = weightCtx.createLinearGradient(0, 0, 0, 280);
    weightGradient.addColorStop(0, 'rgba(255,0,110,0.6)');
    weightGradient.addColorStop(1, 'rgba(131,56,236,0.1)');
    
    if(weightChart) weightChart.destroy();
    weightChart = new Chart(weightCtx, {
      type: 'line',
      data: {
        labels: dates,
        datasets: [{
          label: 'Weight (kg)',
          data: weights,
          borderColor: '#ff006e',
          backgroundColor: weightGradient,
          borderWidth: 4,
          tension: 0.4,
          fill: true,
          pointRadius: 7,
          pointBackgroundColor: '#ff006e',
          pointBorderColor: '#fff',
          pointBorderWidth: 3,
          pointHoverRadius: 10,
          pointHoverBackgroundColor: '#ff006e',
          pointHoverBorderWidth: 4
        },{
          label: 'Goal',
          data: Array(weights.length).fill(GOAL.targetWeight),
          borderColor: '#00f5ff',
          borderWidth: 3,
          borderDash: [10,5],
          fill: false,
          pointRadius: 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: true,
            position: 'top',
            labels: {
              color: '#f4f1ff',
              font: {size: 13, weight: '700', family: 'Fredoka'},
              usePointStyle: true,
              padding: 16
            }
          },
          tooltip: {
            backgroundColor: 'rgba(45,27,78,0.98)',
            titleColor: '#f4f1ff',
            titleFont: {size: 14, weight: '700'},
            bodyColor: '#f4f1ff',
            bodyFont: {size: 16, weight: '700', family: 'Fredoka'},
            padding: 14,
            borderColor: '#ff006e',
            borderWidth: 2,
            cornerRadius: 12
          }
        },
        scales: {
          x: {
            ticks: {color: '#b8a4d4', font: {weight: '600', size: 11}},
            grid: {color: 'rgba(255,255,255,0.05)'}
          },
          y: {
            ticks: {
              color: '#b8a4d4',
              font: {weight: '700', size: 12, family: 'Fredoka'},
              callback: (value) => value + ' kg'
            },
            grid: {color: 'rgba(255,255,255,0.05)'}
          }
        }
      }
    });

    // Weight Change Chart
    const changes = [];
    for(let i = 1; i < weights.length; i++){
      changes.push(weights[i] - weights[i-1]);
    }
    
    const changeCtx = document.getElementById('changeChart').getContext('2d');
    if(changeChart) changeChart.destroy();
    changeChart = new Chart(changeCtx, {
      type: 'bar',
      data: {
        labels: dates.slice(1),
        datasets: [{
          label: 'Change',
          data: changes,
          backgroundColor: changes.map(c => c < 0 ? '#00f5ff' : '#ff006e'),
          borderRadius: 12,
          barThickness: 20
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {display: false},
          tooltip: {
            backgroundColor: 'rgba(45,27,78,0.98)',
            titleColor: '#f4f1ff',
            bodyColor: '#f4f1ff',
            bodyFont: {size: 14, weight: '700', family: 'Fredoka'},
            padding: 12,
            borderColor: '#ff006e',
            borderWidth: 2,
            cornerRadius: 12,
            callbacks: {
              label: (context) => {
                const val = context.parsed.y;
                return (val < 0 ? 'â†“ ' : 'â†‘ ') + Math.abs(val).toFixed(1) + ' kg';
              }
            }
          }
        },
        scales: {
          x: {
            ticks: {color: '#b8a4d4', font: {weight: '600', size: 10}},
            grid: {display: false}
          },
          y: {
            ticks: {
              color: '#b8a4d4',
              font: {weight: '700'},
              callback: (value) => value.toFixed(1)
            },
            grid: {color: 'rgba(255,255,255,0.05)'}
          }
        }
      }
    });
  }

  function render(){
    updateStats();
    renderTable();
    renderCharts();
  }

  // Load CSV
  Papa.parse(CSV_URL, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: (res) => {
      WEIGHT_DATA = res.data;
      
      // Merge with localStorage entries
      const localEntries = JSON.parse(localStorage.getItem('fittrack_entries') || '[]');
      if(localEntries.length > 0){
        const formattedLocal = localEntries.map(e => ({
          Date: e.Date,
          'Weight in Kg': e['Weight in Kg']
        }));
        WEIGHT_DATA = [...WEIGHT_DATA, ...formattedLocal];
      }
      
      // Sort by date
      WEIGHT_DATA.sort((a,b) => {
        const dateA = parseWeightDate(a.Date);
        const dateB = parseWeightDate(b.Date);
        return dateA.localeCompare(dateB);
      });
      
      console.log('âœ… Weight data loaded:', WEIGHT_DATA.length, 'entries');
      
      render();
    },
    error: (err) => {
      console.error('CSV load error', err);
      alert('âš ï¸ Failed to load weight.csv');
    }
  });
</script>

</body>
</html>
